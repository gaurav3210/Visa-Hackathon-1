{% include "./common/header.html" %}
<link rel="stylesheet" href="{{ url_for('static',filename='./place_order/place_order.css') }}">
<script>
    function updateInput(dID, pID, dpID) {
        var discount = document.getElementById(dID).value;
        var cost = document.getElementById(pID).innerText;
        var fcost = document.getElementById(dpID);
        fcost.innerText = cost - (cost * (discount / 100));
    }
</script>

<body>
    <h2> Place your Orders here </h2>

    {% if products %}
    <div class="container">
        <table class="table table-bordered">
            <tr>
                <th> ProductID </th>
                <th> Name </th>
                <th> Description </th>
                <th> Price </th>
                <th> Offers </th>
                <th> Quantity </th>
                <th> Category </th>
                <th> Discounted Price </th>
                <th> Add </th>
            </tr>

            {% for item in products %}
            <tr>
                <td> {{item['ProductID']}} </td>
                <td> {{item['Name']}} </td>
                <td> {{item['Description']}} </td>
                <td value={{item[ 'Price']}} id="price{{loop.index0}}"> {{item['Price']}} </td>

                <td>
                    {% if offers[item['ProductID']]|length > 0 %}
                    <select name="offerOptions" id="offerOptions{{loop.index0}}" onchange="updateInput('offerOptions{{loop.index0}}', 'price{{loop.index0}}', 'dprice{{loop.index0}}')">
                        <option value=0 selected="true "> 0 </option>
                        {% for offer in offers[item['ProductID']] %}
                        <option value={{offer['DiscountPercentage']}}> {{offer['DiscountPercentage']}} </option>
                        {% endfor %}
                    </select> {% else %} {{"No offers "}} {% endif %}
                </td>

                <td> {{item['Quantity']}} </td>
                <td> {{item['Category']}} </td>
                <td value={{item[ 'Price']}} id="dprice{{loop.index0}}"> {{item['Price']}} </td>
                <td>
                    <input name="qty " id="qty " type="number " min="0 " max={{item[ 'Quantity']}}>
                </td>

                {% if offers[item['ProductID']]|length > 0 %}
                <script>
                    updateInput('offerOptions{{loop.index0}}', 'price{{loop.index0}}', 'dprice{{loop.index0}}');
                </script>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
        <button type="submit ">ADD ALL ITEMS IN CART</button>
    </div>
    {% endif %}
</body>

<script>
    function check(quantity, lLimit, uLimit) {
        if (quantity > uLimit) {
            alert("SORRY WE ONLY HAVE " + uLimit + " UNITS IN OUR STOCK. ");
        }
        quantity = Math.min(quantity, uLimit);
        quantity = Math.max(quantity, lLimit);
        document.getElementById("qty ").value = quantity;
    }
</script>
<script src="{{ url_for( 'static',filename='./place_order/cart_feature.js' )}} "></script>

</html>