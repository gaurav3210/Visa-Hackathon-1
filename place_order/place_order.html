{% include "./common/header.html" %}
<link rel="stylesheet" href="{{ url_for('static',filename='./place_order/place_order.css') }}">
<script>
    function updateTotalPrice(pppID, qrID, disID, tpID, dpID) {
        var price = document.getElementById(pppID).innerText;
        var qty = document.getElementById(qrID).value;
        var tprice = document.getElementById(tpID);
        tprice.innerText = price * qty;
        updateDiscount(disID, tpID, dpID);
    }

    function updateDiscount(disID, tpID, dpID) {
        var discount = document.getElementById(disID);
        var cost = document.getElementById(tpID);
        var fcost = document.getElementById(dpID);

        if (discount != null && cost != null) {
            discount = discount.value;
            cost = cost.innerText;
            fcost.innerText = cost - (cost * (discount / 100));
        } else {
            fcost.innerText = cost.innerText;
        }
    }
</script>

<body>
    <h2> Place your Orders here </h2>

    {% if products %}
    <div class="container">
        <table class="table table-bordered">
            <tr>
                <th> Product </th>
                <th> Category </th>
                <th> Price Per Piece </th>
                <th> Quantity in Stock</th>
                <th> Quantity Required </th>
                <th> Select Discount (%) </th>
                <th> Product total amount </th>
                <th> Amount after discount </th>

            </tr>

            {% for item in products %}
            <tr>
                <!-- <td> {{item['ProductID']}} </td> -->
                <td> {{item['Name']}} - <br>
                    <font size="2dp"> {{item['Description']}} </font>
                </td>
                <td> {{item['Category']}} </td>
                <td value={{item[ 'Price']}} id="price{{loop.index0}}"> {{item['Price']}} </td>
                <td value={{item[ 'Quantity']}} id="tquantity{{loop.index0}}"> {{item['Quantity']}} </td>
                <td>
                    <input type="number" id="quantity{{loop.index0}}" min="0" max="{{item['Quantity']}}" value="0" onchange="updateTotalPrice('price{{loop.index0}}', 'quantity{{loop.index0}}', 'offerOptions{{loop.index0}}', 'tprice{{loop.index0}}', 'dprice{{loop.index0}}')">
                </td>
                <td>
                    {% if offers[item['ProductID']]|length > 0 %}
                    <select name="offerOptions" id="offerOptions{{loop.index0}}" onchange="updateDiscount('offerOptions{{loop.index0}}', 'tprice{{loop.index0}}', 'dprice{{loop.index0}}')">
                        <option value=0 selected="true "> No discount </option>
                        {% for offer in offers[item['ProductID']] %}
                        <option value={{offer['DiscountPercentage']}}> {{offer['Information']}} </option>
                        {% endfor %}
                    </select> {% else %} {{"No offers "}} {% endif %}
                </td>
                <td id="tprice{{loop.index0}}"> </td>
                <td value={{item[ 'Price']}} id="dprice{{loop.index0}}"> {{item['Price']}} </td>

            </tr>
            {% if offers[item['ProductID']]|length > 0 %}
            <script>
                updateDiscount('offerOptions{{loop.index0}}', 'tprice{{loop.index0}}', 'dprice{{loop.index0}}');
            </script>
            {% endif %}

            <script>
                updateTotalPrice('price{{loop.index0}}', 'quantity{{loop.index0}}', 'offerOptions{{loop.index0}}', 'tprice{{loop.index0}}', 'dprice{{loop.index0}}');
            </script>
            {% endfor %}
        </table>
        <button type="submit ">ADD ALL ITEMS IN CART</button>
    </div>
    {% endif %}
</body>

<script>
    function check(quantity, lLimit, uLimit) {
        if (quantity > uLimit) {
            alert("SORRY WE ONLY HAVE " + uLimit + " UNITS IN OUR STOCK. ");
        }
        quantity = Math.min(quantity, uLimit);
        quantity = Math.max(quantity, lLimit);
        document.getElementById("qty ").value = quantity;
    }
</script>
<script src="{{ url_for( 'static',filename='./place_order/cart_feature.js' )}} "></script>

</html>